<section class="content-header">

  <section class="content">

  <form #form="ngForm" novalidate>
      <div class="col-sm-4 col-xs-6">
        <div class="form-group">
          <label class="control-label sr-only" for="inputSuccess"><i class="fa fa-check"></i> Selecione o módulo:</label>
          <div class="col-xs-12">
            <p class="control-label"> Selecione o Usuário </p>
          </div>
          <div class="col-sm-12 col-xs-6">
            <select #idUsuario (change)="getAcessosModulo(idUsuario.value)"
                required
                placeholder="Usuários"
                name="idUsuario"
                id="idUsuario"
                class="form-control"
                ngModel="0">
                <option [value]="0"> SELECIONE </option>
                <option *ngFor="let item of usuarios" [value]="item.id" ngModel="0">{{ item.nome.toUpperCase() }}</option>
            </select>
          </div>

        </div>
      </div>

      <div style="width: 65%;">

        <div class="row">
            <div class="col-xs-11">
              <button *ngIf="selecionados.length > 0" (click)="putAcessos(idUsuario.value)" class="btn btn-success pull-right"
              [disabled]="!form.valid"><i></i> Salvar
              </button>
              <button (click)="cancelar()" class="btn btn-primary pull-right"><i></i> Cancelar
              </button>
            </div>
        </div>
      </div>

    <br>

    <section class="content">
      <form [formGroup]="myForm">
        <table ngModel class="table-striped" style="width: 60%;">
          <thead>
            <tr>
                <th class="pointer" scope="col" [appSort]="perfilModulos" data-order="desc" data-name="id" style="width: 50px;"><span>ID</span></th>
                <th class="pointer" scope="col" [appSort]="perfilModulos" data-order="desc" data-name="descricao">Nome do Módulo</th>
                <th style="width: 30px;" scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <tr  *ngFor="let mod of perfilModulos | paginate: { id: 'pagination1', itemsPerPage: contador, currentPage: pag }">
              <td class="textCenter" >
                <div class="pointer" *ngIf="mod.acesso == true; else templateIdModulo" (click)="openModal(idUsuario.value, mod.idModulo, mod.nomeModulo)">{{ formatId(mod.idModulo, 6) }}</div>
                <ng-template #templateIdModulo>
                  {{ formatId(mod.idModulo, 6) }}
                </ng-template>
              </td>
              <td>
                  <div class="pointer" *ngIf="mod.acesso == true; else templateDescricao" (click)="openModal(idUsuario.value, mod.idModulo, mod.nomeModulo)">{{ mod.nomeModulo.toUpperCase() }}</div>
                  <ng-template #templateDescricao>
                    {{ mod.nomeModulo.toUpperCase() }}
                  </ng-template>
              </td>
              <td class="textCenter">
                <div class="pointer">
                  <input type="checkbox" (change)="addAcesso(mod, $event.target.checked)" name="acesso" id="acesso" #acesso [checked]="mod.acesso" />
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!--inclindo o controle de paginação.-->
        <div style="padding: 20px; width: 60%;">
          <div class="text-right">
            <pagination-controls id="pagination1" class="pointer" (pageChange)="pageChanged($event)"
              previousLabel="Anterior"
              nextLabel="Próximo"></pagination-controls>
          </div>
        </div>
      </form>

    </section>
   </form>
  </section>
</section>

<section class="content">
  <jw-modal id="custom-modal-1">
    <h1><b>Acessos às Funcionalidades do Módulo: {{nomeModulo}}</b></h1>

    <section class="content">
      <form #formFunc="ngForm" [formGroup]="myFormModal">
        <table ngModel class="table-striped" style="width: 100%;">
          <thead>
            <tr>
                <th class="pointer" scope="col" [appSort]="perfilFuncionalidades" data-order="desc" data-name="id" style="width: 50px;"><span>ID</span></th>
                <th class="pointer" scope="col" [appSort]="perfilFuncionalidades" data-order="desc" data-name="funcionalidade">Funcionalidade</th>
                <th style="width: 30px;" scope="col">Acesso</th>
                <th style="width: 30px;" scope="col">Inclusão</th>
                <th style="width: 30px;" scope="col">Alteração</th>
                <th style="width: 30px;" scope="col">Exclusão</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let func of perfilFuncionalidades | paginate: { id: 'pagination2', itemsPerPage: contadorModal, currentPage: pagModal }">
              <td class="textCenter" >
                <div>{{ formatId(func.idFuncionalidade, 6) }}</div>
              </td>
              <td>
                  <div>{{ func.nomeFuncionalidade.toUpperCase() }}</div>
              </td>
              <td class="textCenter">
                <div class="pointer">
                  <input type="checkbox" (change)="addAcessoFuncionalidade(func, $event.target.checked, 'acesso')" name="acesso" id="acesso" #acesso [checked]="func.acesso" />
                </div>
              </td>
              <td class="textCenter">
                <div class="pointer">
                  <input type="checkbox" (change)="addAcessoFuncionalidade(func, $event.target.checked, 'inclusao')" name="inclusao" id="inclusao" #inclusao [checked]="func.inclusao" />
                </div>
              </td>
              <td class="textCenter">
                <div class="pointer">
                  <input type="checkbox" (change)="addAcessoFuncionalidade(func, $event.target.checked, 'alteracao')" name="alteracao" id="alteracao" #alteracao [checked]="func.alteracao" />
                </div>
              </td>
              <td class="textCenter">
                <div class="pointer">
                  <input type="checkbox" (change)="addAcessoFuncionalidade(func, $event.target.checked, 'exclusao')" name="exclusao" id="exclusao" #exclusao [checked]="func.exclusao" />
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!--inclindo o controle de paginação.-->
        <div style="padding: 20px; width: 100%;">
          <div class="text-right">
            <pagination-controls id="pagination2" class="pointer" (pageChange)="pageChangedModal($event)"
              previousLabel="Anterior"
              nextLabel="Próximo"></pagination-controls>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <button *ngIf="selecionadosFunc.length > 0" (click)="putAcessosFuncionalidade(idUsuario.value)" class="btn btn-success pull-right"><i></i> Salvar
              <i class="fa fa-floppy-o" aria-hidden="false"></i>
            </button>
            <button (click)="closeModal('custom-modal-1')" class="btn btn-primary pull-right"><i></i> Cancelar
            </button>
          </div>
        </div>

      </form>

    </section>
  </jw-modal>
</section>
